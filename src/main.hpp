/******************************************************************************
 * @file    src/main.hpp
 * @project ColorTestSDL2
 * @brief   Handles init/quit, and the main window
 * @author  ImpendingMoon
 * @created 9/2/2023
 ******************************************************************************/



#ifndef COLORTESTSDL2_MAIN_HPP
#define COLORTESTSDL2_MAIN_HPP

#include <SDL2/SDL.h>
#include <array>
#include <vector>
#include <cstdint>

int initSDL2();

void quitSDL2();

void handleEvents();

/**
 * @brief Loads a new bitmap, and renders it as an indexed texture
 * @param filepath
 * @return 0 on success, 1 on failure
 */
int loadNewBMP(const std::string& filepath);

/**
 * @brief Clears the window and renders a new surface onto it.
 * @param surface Pointer to an existing surface. Main does not obtain ownership of it.
 */
int renderNewSurface(SDL_Surface* surface);

int convertSurfaceToIndex(SDL_Surface* source, SDL_Surface* dest);

uint8_t findClosestPaletteEntry(SDL_Color color);

void updateDarkLevel();

void updateUnderwater();

constexpr std::array<SDL_Color, 256> palette = {{
      {255,255,255}, {255,  0,  0}, {255,102,  0}, {255,153,  0},
      {255,204,  0}, {255,255,  0}, {204,255,  0}, {  0,255,  0},
      {  0,179, 24}, {  0,204,255}, {  0,102,255}, {  0,  0,255},
      {102,  0,255}, {153,  0,255}, {204,  0,255}, {255,  0,204},
      {255,255,255}, {255,139,122}, {255,192,122}, {255,219,122},
      {255,246,122}, {238,255,122}, {210,255,122}, {122,255,139},
      { 85,179,110}, {122,210,255}, {122,157,255}, {139,122,255},
      {192,122,255}, {219,122,255}, {246,122,255}, {255,122,210},
      {245,235,215}, {218,  0,  4}, {218, 84,  0}, {218,127,  0},
      {218,171,  0}, {218,214,  0}, {178,218,  0}, {  4,218,  0},
      {  0,153, 18}, {  0,178,218}, {  0, 91,218}, {  0,  4,218},
      { 84,  0,218}, {127,  0,218}, {171,  0,218}, {218,  0,178},
      {207,218,218}, {218,112, 99}, {218,160, 99}, {218,184, 99},
      {218,207, 99}, {205,218, 99}, {181,218, 99}, { 99,218,112},
      { 69,153, 90}, { 99,181,218}, { 99,132,218}, {112, 99,218},
      {160, 99,218}, {184, 99,218}, {207, 99,218}, {218, 99,181},
      {165,156,144}, {165,  0, 12}, {165, 54,  0}, {165, 88,  0},
      {165,121,  0}, {165,154,  0}, {142,165,  0}, { 12,165,  0},
      {  0,115,  8}, {  0,142,165}, {  0, 77,165}, {  0, 12,165},
      { 54,  0,165}, { 88,  0,165}, {121,  0,165}, {165,  0,142},
      {156,165,165}, {165, 77, 71}, {165,114, 71}, {165,132, 71},
      {165,153, 71}, {157,165, 71}, {138,165, 71}, { 71,165, 77},
      { 50,115, 63}, { 71,138,165}, { 71,102,165}, { 77, 71,165},
      {114, 71,165}, {132, 71,165}, {153, 71,165}, {165, 71,138},
      {120,113,105}, {120,  0, 13}, {120, 36,  0}, {120, 60,  0},
      {120, 84,  0}, {120,108,  0}, {107,120,  0}, { 13,120,  0},
      {  0, 84,  3}, {  0,107,120}, {  0, 60,120}, {  0, 13,120},
      { 36,  0,120}, { 60,  0,120}, { 84,  0,120}, {120,  0,107},
      {113,120,119}, {120, 55, 52}, {120, 81, 52}, {120, 93, 52},
      {120,108, 52}, {117,120, 52}, {104,120, 52}, { 52,120, 55},
      { 36, 84, 43}, { 52,104,120}, { 52, 76,120}, { 55, 52,120},
      { 81, 52,120}, { 93, 52,120}, {108, 52,120}, {120, 52,104},
      { 87, 82, 77}, { 87,  0, 12}, { 87, 22,  0}, { 87, 39,  0},
      { 87, 57,  0}, { 87, 75,  0}, { 81, 87,  0}, { 12, 87,  0},
      {  1, 60,  0}, {  0, 81, 87}, {  0, 47, 87}, {  0, 12, 87},
      { 22,  0, 87}, { 39,  0, 87}, { 57,  0, 87}, { 87,  0, 81},
      { 81, 87, 86}, { 87, 36, 36}, { 87, 58, 36}, { 87, 67, 36},
      { 87, 77, 36}, { 87, 87, 36}, { 77, 87, 36}, { 36, 87, 36},
      { 27, 60, 31}, { 36, 77, 87}, { 36, 57, 87}, { 36, 36, 87},
      { 58, 36, 87}, { 67, 36, 87}, { 77, 36, 87}, { 87, 36, 77},
      { 61, 58, 56}, { 61,  0, 12}, { 61, 14,  0}, { 61, 28,  0},
      { 61, 38,  0}, { 61, 52,  0}, { 59, 61,  0}, { 12, 61,  0},
      {  2, 43,  0}, {  0, 59, 61}, {  0, 36, 61}, {  0, 12, 61},
      { 14,  0, 61}, { 28,  0, 61}, { 38,  0, 61}, { 61,  0, 59},
      { 60, 61, 61}, { 61, 27, 29}, { 61, 38, 27}, { 61, 47, 27},
      { 61, 56, 27}, { 61, 60, 27}, { 56, 61, 27}, { 29, 61, 27},
      { 18, 43, 22}, { 27, 56, 61}, { 27, 42, 61}, { 27, 29, 61},
      { 38, 27, 61}, { 47, 27, 61}, { 56, 27, 61}, { 61, 27, 56},
      { 44, 40, 36}, { 44,  0, 12}, { 44, 12,  0}, { 44, 17,  0},
      { 44, 27,  0}, { 44, 34,  0}, { 44, 44,  0}, { 12, 44,  0},
      {  3, 32,  0}, {  0, 44, 44}, {  0, 28, 44}, {  0, 12, 44},
      { 12,  0, 44}, { 17,  0, 44}, { 27,  0, 44}, { 44,  0, 44},
      { 41, 44, 43}, { 44, 19, 23}, { 44, 28, 19}, { 44, 33, 19},
      { 44, 36, 19}, { 44, 41, 19}, { 38, 44, 19}, { 23, 44, 19},
      { 12, 32, 13}, { 19, 38, 44}, { 19, 31, 44}, { 19, 23, 44},
      { 28, 19, 44}, { 33, 19, 44}, { 36, 19, 44}, { 44, 19, 38},
      { 29, 27, 25}, { 31,  0,  9}, { 31,  6,  0}, { 31, 11,  0},
      { 31, 16,  0}, { 31, 23,  0}, { 31, 31,  0}, {  9, 31,  0},
      {  4, 22,  0}, {  0, 31, 31}, {  0, 18, 31}, {  0,  9, 31},
      {  6,  0, 31}, { 11,  0, 31}, { 16,  0, 31}, { 31,  0, 31},
      { 29, 31, 31}, { 31, 13, 16}, { 31, 17, 13}, { 31, 22, 13},
      { 31, 25, 13}, { 31, 29, 13}, { 30, 31, 13}, { 16, 31, 13},
      { 11, 22, 11}, { 13, 30, 31}, { 13, 22, 31}, { 13, 16, 31},
      { 17, 13, 31}, { 22, 13, 31}, { 25, 13, 31}, {  0,  0,  0}
}};

#endif //COLORTESTSDL2_MAIN_HPP
